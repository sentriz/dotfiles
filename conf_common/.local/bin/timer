#!/usr/bin/env bash

future_file="$XDG_CACHE_HOME/timer_left"
future="$(cat "$future_file" 2>/dev/null || date "+%s")"
test $# -eq 1 \
    && echo "$(("$future" + "$1"))" >"$future_file" \
    && exit

test ! -e "$future_file" && exit

left="$(("$future" - $(date "+%s")))"
test "$left" -le 0 \
    && notify-send.sh -t 600 "timer" "the time has passed" \
    && ffplay -f lavfi -i "sine=frequency=1108.73:duration=1" -autoexit -nodisp \
    && ffplay -f lavfi -i "sine=frequency=1244.51:duration=1" -autoexit -nodisp \
    && ffplay -f lavfi -i "sine=frequency=1479.98:duration=1" -autoexit -nodisp \
    && rm "$future_file" 2>/dev/null \
    && exit

echo "$left"
