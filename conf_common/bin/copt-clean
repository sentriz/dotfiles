#!/usr/bin/env python3

from glob import glob
import os
import sys
import yaml

try:
    copts_dir = os.environ['DOTS_COPT_DIR']
except KeyError:
    print('DOTS_COPT_DIR not set', file=sys.stderr)
    sys.exit(1)

composeses = glob(os.path.join(copts_dir, '*/docker-compose.yml'))
traefiks = glob(os.path.join(copts_dir, 'traefik/config/*.yml'))

for filename in (*composeses, *traefiks):
    with open(filename) as file:
        before = yaml.load(file)
    with open(filename, 'w') as file:
        yaml.dump(before, file, default_flow_style=False)
