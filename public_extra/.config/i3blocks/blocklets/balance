#!/usr/bin/env bash

# requires:
# - pip boi-balance
# - pip revolut

function get-balance-boi() {
    boi-balance \
        "$(secret boi_username)" \
        "$(secret boi_phonenumber)" \
        "$(secret boi_password)" \
        "$(secret boi_dob)"
}

function get-balance-revolut() {
    revolut_cli.py \
        --language en \
        --token "$(secret revolut_token)" \
        --account "EUR CURRENT" \
        | awk '{print $1}'
}

balance="$(
    case "$BLOCK_INSTANCE" in
        'boi')     get-balance-boi;;
        'revolut') get-balance-revolut;;
        *)         exit 1;;
    esac
)"
[ -z "$balance" ] && exit 1
test "$BLOCK_BUTTON" -eq 1 2>/dev/null && notify-send -- "$BLOCK_INSTANCE updated"
printf "%'.2f\n" "$balance" | sed -E 's/(\-|\+)?(.*)/\1â‚¬\2/'
