#!/bin/bash

if pgrep "^dock_watch$"; then
    exit 1
fi

last_state="none"
while true; do

    if grep -q "1" /sys/devices/platform/dock.*/docked; then
        touch /tmp/fdock
        if [ "$last_state" == "undocked" ] || [ "$last_state" == "none" ]; then
            sleep 2
            sudo -E dock
        fi
        last_state="docked"
    else
        touch /tmp/fudock
        if [ "$last_state" == "docked" ]; then
            sudo -E undock
        fi
        last_state="undocked"
    fi
    sleep 1

done
