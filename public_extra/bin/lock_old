#!/usr/bin/env fish

# extra requirements:
# - scrot
# - imagemagic
# - i3lock-color
# - triangle_swirl by https://github.com/EdwardDowling

set -l image (mktemp /tmp/lock_XXXX.png)
set -l text "locked since "(date +%H:%M)
set -l colour (random choice red blue green violet indigo \#feca1e \#dad15dead)

scrot $image
triangle_swirl $image \
               $image \
               (random 8 30)
test 0 -eq (random 0 10); and \
    convert $image \
            \( ~/pictures/misc/fiji.png -thumbnail x(random 150 500) -background none -rotate (random 0 360) \) -gravity center -geometry  +(math (random 0 1000) - 500)+(math (random 0 1000) - 500) -composite \
            \( ~/pictures/misc/fiji.png -thumbnail x(random 150 500) -background none -rotate (random 0 360) \) -gravity center -geometry  +(math (random 0 1000) - 500)+(math (random 0 1000) - 500) -composite \
            \( ~/pictures/misc/fiji.png -thumbnail x(random 150 500) -background none -rotate (random 0 360) \) -gravity center -geometry  +(math (random 0 1000) - 500)+(math (random 0 1000) - 500) -composite \
            \( ~/pictures/misc/bust.png -thumbnail x(random 150 500) -background none -rotate (random 0 360) \) -gravity center -geometry  +(math (random 0 1000) - 500)+(math (random 0 1000) - 500) -composite \
            \( ~/pictures/misc/bust.png -thumbnail x(random 150 500) -background none -rotate (random 0 360) \) -gravity center -geometry  +(math (random 0 1000) - 500)+(math (random 0 1000) - 500) -composite \
            \( ~/pictures/misc/bust.png -thumbnail x(random 150 500) -background none -rotate (random 0 360) \) -gravity center -geometry  +(math (random 0 1000) - 500)+(math (random 0 1000) - 500) -composite \
            $image
convert $image \
    -font 'Bitstream-Vera-Sans-Mono' \
    -gravity North \
    -fill $colour \
    -pointsize 80 \
    -annotate -3+53 "$text" \
    -fill white \
    -pointsize 80 \
    -annotate +0+50 "$text" \
    $image
i3lock -bfen \
       --insidevercolor=0000a0bf \
       --insidewrongcolor=ff8000bf \
       --insidecolor=ffffffbf \
       --ringvercolor=0020ffff \
       --ringwrongcolor=4040ffff \
       --ringcolor=404090ff \
       --textcolor=ffffffff \
       --separatorcolor=aaaaaaff \
       --keyhlcolor=30ccccff \
       --bshlcolor=ff8000ff \
       -i $image
rm $image > /dev/null
