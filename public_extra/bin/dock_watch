#!/bin/bash

if [ -f /tmp/dock_watching ]; then
    echo "already watching"
    exit 1
fi

touch /tmp/dock_watching

inotifywait -m -q -e moved_to /tmp/ --format "%f" | while read line
do
    echo $line

    $uptime=$(uptime | sed -e 's/^.*up //' -e 's/[^0-9:].*//' | sed 's/:/*60+/g')

    if [ "$line" == "docked" ]; then
        sleep 1.8
        dock
    elif [ "$line" == "not_docked" ] && [ "$uptime" -gt "2" ]; then
        undock
        notify-send "okay to undock"
    fi

done
