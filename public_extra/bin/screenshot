#!/usr/bin/env fish

set screen_dir "$HOME/pictures/screenshots"

getopts $argv | while read -l key value
    switch $key
        case upload
            set upload 'true'
        case select
            set select_option '-s'
    end
end

if test -n "$select_option"
    notify-send 'screenshot' 'select an area'
end

set filename (
    scrot "$screen_dir/%Y%m%d_%H%M%S.png" \
        $select_option \
        -e 'echo $f'
)

# add to socr database
# see https://github.com/sentriz/socr
socr add "$filename" &

if test "$upload" = 'true'
    echo "$filename" | imgur_up | xclip -i
    notify-send 'screenshot' 'link in clipboad'
else
    notify-send 'screnshot taken' (basename "$filename")
end

