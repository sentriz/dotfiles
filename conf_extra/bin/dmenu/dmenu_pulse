#!/usr/bin/env bash

if ! which pacmd >/dev/null 2>&1; then
    echo "please install pulsemixer" >&2
    exit 1
fi

lower() {
    tr '[[:upper:]]' '[[:lower:]]'
}

sinks="$(paste \
    --delimiters " " \
    <(pacmd list-sinks | grep -Po "index\: \K\d+") \
    <(pacmd list-sinks | grep -Po "device\.description \= \"\K([^\"]+)" | lower)
)"
sink="$(dmenu_custom -p 'sink' <<< "$sinks")"
test -z "$sink" && exit 1

sink_index="${sink/%\ */}"
pacmd set-default-sink "$sink_index"
pacmd list-sink-inputs \
    | grep -Po "index\: \K\d+" \
    | xargs -L 1 -I {} pacmd move-sink-input {} "$sink_index"
