#!/usr/bin/env bash

stations="$(find \
    "$DOTS_RADIO_DIR" \
    -maxdepth 1 \
    -not -name '.st*' \
    -type f \
    -printf "play %f\n"
)"
selection="$(printf "%s\n" "$stations" "stop" | dmenu_custom -p 'station')"
test -z "$selection" && exit 1

pkill -f '^mpv.*radio'
test "$selection" = "stop" && exit

station="$(awk '{print $2}' <<< "$selection")"
station_friendly="${station//_/\ }"
mpv \
    --no-ytdl \
    --no-video \
    --no-cache \
    --quiet \
    --force-media-title="$station_friendly" \
    --no-resume-playback \
    "$DOTS_RADIO_DIR/$station" &
notify-send.sh 'started radio station' "$station_friendly"
