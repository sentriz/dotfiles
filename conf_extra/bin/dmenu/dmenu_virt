#!/usr/bin/env bash

if ! type -p virsh >/dev/null; then
    echo "please install libvirt" >&2
    exit 1
fi

if ! type -p virt-viewer >/dev/null; then
    echo "please install virt-viewer" >&2
    exit 1
fi

connect_uri="$(secret virt_connect_uri)"
machines="$(virsh --connect "$connect_uri" list --name)"
test -z "$machines" && exit 1

machine="$(printf "%s\n" "$machines" | dmenu_custom -p "virtual machine")"
test -z "$machine" && exit 1

virt-viewer --connect "$connect_uri" "$machine"
