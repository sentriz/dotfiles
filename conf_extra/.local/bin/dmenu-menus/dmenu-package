#!/usr/bin/env fish

set -l files (find $XDG_DATA_DIRS/applications -name "*.desktop" 2>/dev/null)
set -l application (grep -l "^Type=Application" $files | sort -r | dmenu application)
test -z "$application" && exit

set -l command (grep -Po "^Exec=\K.*" "$application" | head -n 1)
test -z "$command" && exit 1

# we don't care about passing arguments
# https://specifications.freedesktop.org/desktop-entry-spec/latest/ar01s07.html
set -l command (echo "$command" | sed -E -s 's/\%(f|F|u|U|d|D|n|N|i|c|k|v|m)//g;s/@@\w?//g')

swaymsg exec -- "$command"
