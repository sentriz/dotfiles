#!/usr/bin/env bash

if ! type -p fzf >/dev/null; then
    echo "please install fzf" >&2
    exit 1
fi

prompt="$1"
column="$2"

if test -z "$prompt"; then
    echo "please provide a prompt" >&2
    exit 1
fi

dir="$(mktemp --directory --tmpdir="$XDG_CACHE_HOME")"
trap 'rm -r "$dir"' EXIT

in="$dir/in"
out="$dir/out"

mkfifo "$in" "$out"

command=("fzf" "--prompt" "'$prompt '")
if test -n "$column"; then
    command+=("--delimiter" "$'\t'" "--with-nth" "$column")
fi

"$TERMINAL" --app-id launcher sh -c "theme light; ${command[*]} <$in >$out" 2>/dev/null &
cat <"$out" &
cat >"$in"

wait
