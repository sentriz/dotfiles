#!/usr/bin/env bash

if [[ "$#" -gt 0 ]]; then
    IFS=$'\t' read -r id _ <<<"$1"
    tuned-adm profile "$id"
    exit 0
fi

highlight=$'\x1b]6366;highlight\x07'

output="$(tuned-adm profile)"

active="$(grep -Po "^Current.*: \K.*" <<<"$output")"
grep "^-" <<<"$output" | col "- " 2 3 | sort | while IFS=$'\t' read -r id desc; do
    case "$id" in
    *"power"* | *"perf"* | *"balance"*) ;;
    *) continue ;;
    esac

    pre=""
    [[ "$id" == "$active" ]] && pre="$highlight"
    printf "%s%s\t%s\n" "$pre" "$id" "$desc"
done
